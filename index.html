<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nostalgia Airdrop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Nostalgia Airdrop & Selfdrop Dashboard on Base" />

  <!-- Open Graph -->
  <meta property="og:title" content="Nostalgia Airdrop" />
  <meta property="og:description" content="Join the $NOST Airdrop — connect wallet, mint your memory, and share your referral link." />
  <meta property="og:image" content="https://nost.vercel.app/og.png" />
  <meta property="og:url" content="https://nost.vercel.app" />
  <meta property="og:type" content="website" />

  <!-- Farcaster MiniApp Embed -->
  <meta
    name="fc:miniapp"
    content='{"version":"1","imageUrl":"https://nost.vercel.app/og.png","button":{"title":"Join NOST Airdrop","action":{"type":"launch_miniapp","name":"Nostalgia Airdrop","url":"https://nost.vercel.app","splashImageUrl":"https://nost.vercel.app/og.png","splashBackgroundColor":"#0d1117"}}}'
  />

  <link rel="icon" type="image/png" href="https://nost.vercel.app/icon.png" />

  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
    body{
      margin:0;
      min-height:100vh;
      background:radial-gradient(circle at top,#0b1120,#020617 75%);
      color:#e5e7eb;
      display:flex;
      justify-content:center;
      opacity:0;
      transition:opacity .4s ease-in-out;
    }
    main{
      width:100%;
      max-width:760px;
      padding:20px 16px 40px;
    }
    .card{
      background:rgba(15,23,42,0.95);
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.25);
      padding:18px 18px 20px;
      margin-bottom:16px;
      box-shadow:0 18px 50px rgba(15,23,42,0.85);
      backdrop-filter:blur(22px);
    }
    h1{margin:4px 0 6px;font-size:23px;color:#f9fafb}
    h2{margin:0 0 8px;font-size:18px;color:#e5e7eb}
    .muted{font-size:13px;color:#9ca3af}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:3px 10px;border-radius:999px;background:rgba(37,99,235,0.12);color:#bfdbfe;font-size:11px;margin-bottom:6px;}
    .pill-dot{width:7px;height:7px;border-radius:999px;background:radial-gradient(circle,#22c55e,#15803d);box-shadow:0 0 8px #22c55e;}
    .row{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px;font-size:13px;}
    .row>div{flex:1 1 150px}
    .label{color:#9ca3af;font-size:12px}
    .value{color:#e5e7eb;font-weight:600;margin-top:2px}
    .mono{font-family:"JetBrains Mono","Fira Code",monospace;font-size:12px}
    button{border:none;border-radius:999px;padding:8px 16px;font-size:14px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;}
    #connectBtn{background:rgba(37,99,235,0.12);border:1px solid rgba(59,130,246,0.9);color:#bfdbfe;margin-top:6px;}
    #connectBtn:disabled{opacity:.7;cursor:default}
    #joinBtn,#buyBtn{background:linear-gradient(135deg,#38bdf8,#2563eb);color:#eff6ff;box-shadow:0 10px 30px rgba(37,99,235,0.7);white-space:nowrap;}
    #joinBtn:disabled,#buyBtn:disabled{opacity:.5;box-shadow:none;cursor:default;}
    #shareBtn{background:rgba(15,23,42,1);border:1px solid rgba(148,163,184,0.6);color:#e5e7eb;}
    .progress-bar{width:100%;height:8px;border-radius:999px;background:#020617;border:1px solid rgba(55,65,81,0.9);overflow:hidden;margin-top:6px;}
    .progress-fill{height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg,#22c55e,#38bdf8);box-shadow:0 0 18px rgba(34,197,94,0.7);transition:width .4s ease-out;}
    .progress-text{margin-top:5px;font-size:12px;color:#9ca3af;display:flex;justify-content:space-between;}
    .field{margin-top:8px;font-size:13px}
    .field-label{font-size:12px;color:#9ca3af;margin-bottom:2px}
    .field-box{padding:8px 10px;border-radius:10px;background:#020617;border:1px solid rgba(55,65,81,0.9);word-break:break-all;font-size:12px;}
    .status{margin-top:8px;font-size:12px;min-height:16px}
    .status.ok{color:#4ade80}
    .status.err{color:#f97373}
    .ref-link-copy{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;font-size:12px;}
    .ref-link-copy input{flex:1;min-width:180px;border-radius:8px;border:1px solid rgba(55,65,81,0.9);padding:6px 8px;background:#020617;color:#e5e7eb;font-size:12px;}
    .ref-link-copy button{padding:6px 10px;font-size:12px;}
    input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0;}
    input[type="number"]{-moz-appearance:textfield;}
    @media(max-width:600px){main{padding:14px 10px 28px}.card{padding:16px 14px 18px}h1{font-size:20px}}
  </style>

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
</head>
<body>
<main>
  <section class="card">
    <div class="pill"><span class="pill-dot"></span> Live on Base Mainnet</div>
    <h1>Nostalgia Airdrop &amp; Selfdrop</h1>
    <p class="muted">A tribute to the 2017–2019 era. Send ETH, receive <span class="mono">$NOST</span> — and earn a chance in the airdrop by sharing.</p>
    <button id="connectBtn">Connect wallet</button>

    <div class="row">
      <div><div class="label">Token</div><div class="value mono">$NOST · 1,000,000,000</div></div>
      <div><div class="label">Rate</div><div class="value">1 ETH = 20,000,000 NOST</div></div>
      <div><div class="label">Min / Max</div><div class="value">0.0001 – 1 ETH</div></div>
    </div>
  </section>

  <section class="card">
    <h2>Selfdrop Dashboard</h2>
    <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
    <div class="progress-text"><span id="soldPercent">Sold: loading…</span><span id="soldNumbers" class="mono"></span></div>
    <p class="muted" id="ethRaisedText" style="margin-top:4px">Total ETH raised: loading…</p>

    <div class="row" style="margin-top:10px">
      <div><div class="label">Selfdrop Allocation</div><div class="value">60% (600,000,000 NOST)</div></div>
      <div><div class="label">Treasury / Liquidity</div><div class="value">20% (200,000,000)</div></div>
      <div><div class="label">Community &amp; Rewards</div><div class="value">10% (100,000,000)</div></div>
    </div>

    <div class="field">
      <div class="field-label">Selfdrop Contract</div>
      <div class="field-box mono"><a href="https://basescan.org/address/0x973E86405E0aAe67fFCac61BDF915E517965Be6b" target="_blank" style="color:#93c5fd;text-decoration:none;">0x973E86405E0aAe67fFCac61BDF915E517965Be6b</a></div>
    </div>
    <div class="field">
      <div class="field-label">Token Contract</div>
      <div class="field-box mono"><a href="https://basescan.org/token/0x3ad479478e67990cA70c904B4E4639c764918dFd" target="_blank" style="color:#93c5fd;text-decoration:none;">0x3ad479478e67990cA70c904B4E4639c764918dFd</a></div>
    </div>
  </section>

  <section class="card">
    <h2>Join the Selfdrop</h2>
    <p class="muted">Choose your contribution between <b>0.0001</b> and <b>1 ETH</b>. You’ll receive <span class="mono">$NOST</span> instantly to your address.</p>

    <div class="field">
      <div class="field-label">Contribution amount</div>
      <div style="display:flex;align-items:center;gap:10px;margin-top:4px;">
        <div style="flex:1;position:relative;">
          <input id="ethInput" type="number" step="0.0001" min="0.0001" max="1" value="0.0001" style="width:100%;padding:10px 12px;border-radius:999px;border:1px solid rgba(55,65,81,0.9);background:#020617;color:#e5e7eb;font-size:14px;" />
          <span style="position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:13px;color:#9ca3af;">ETH</span>
        </div>
        <button id="buyBtn" disabled>Buy NOST</button>
      </div>
      <div id="estimateText" class="muted" style="margin-top:6px;">Estimated: 2,000 NOST</div>
      <div id="selfdropStatus" class="status"></div>
    </div>
  </section>

  <section class="card">
    <h2>Join NOST Airdrop</h2>
    <p class="muted">A portion of the <b>Community &amp; Rewards</b> allocation (up to <b>50,000,000 NOST</b>) is reserved for early supporters and referrers.</p>

    <div id="airdropGuest"><p class="muted">Connect your wallet to generate your referral link and join the snapshot list.</p></div>

    <div id="airdropUser" style="display:none;">
      <div class="field-label">Your referral link</div>
      <div class="ref-link-copy">
        <input id="refLinkInput" readonly />
        <button id="copyRefBtn">Copy</button>
      </div>
      <p class="muted" style="margin-top:6px">Share this link. Mints and activity via your link will be considered for the airdrop snapshot.</p>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;">
        <button id="joinBtn">Join NOST Airdrop</button>
        <button id="shareBtn">Share your referral</button>
      </div>
      <div id="airdropStatus" class="status"></div>
    </div>
  </section>
</main>

<script>
  const RATE_PER_ETH = 20000000;
  const MIN_ETH = 0.0001;
  const MAX_ETH = 1;
  const ethInput = document.getElementById("ethInput");
  const estimateText = document.getElementById("estimateText");
  const buyBtn = document.getElementById("buyBtn");

  function updateEstimate() {
    const raw = ethInput.value.trim().replace(",", ".");
    const amount = Number(raw);
    if (!isFinite(amount) || amount < MIN_ETH || amount > MAX_ETH) {
      estimateText.textContent = "Estimated: – NOST";
      buyBtn.disabled = true;
      return;
    }
    const nostAmount = amount * RATE_PER_ETH;
    estimateText.textContent = "Estimated: " + nostAmount.toLocaleString() + " NOST";
    buyBtn.disabled = false;
  }
  ethInput.addEventListener("input", updateEstimate);
  updateEstimate();
</script>

<!-- Mini App SDK Fix -->
<script type="module">
  import { sdk } from "https://esm.sh/@farcaster/miniapp-sdk";

  (async () => {
    try {
      window.__nost_sdk = sdk;
      const isMiniApp = await sdk.isInMiniApp();
      if (isMiniApp) {
        window.__nost_isMiniApp = true;
        const ethProvider = await sdk.wallet.getEthereumProvider();
        window.__nost_miniappProvider = ethProvider;
        document.body.style.opacity = "1";
        await sdk.actions.ready();
      } else {
        window.__nost_isMiniApp = false;
        document.body.style.opacity = "1";
      }
    } catch (err) {
      console.warn("MiniApp init error:", err);
      document.body.style.opacity = "1";
    }
  })();
</script>
</body>
</html>
